---
title: Guide - Windows Server sur MacOS ARM processeurs M1 M2 M3
date: 2024-04-06 11:00:00
categories: [MacOS]
tags: [macbook, arm, m1, m2, m3, virtualisation]     #TAG names should always be lowercase
author: GoXLd
pin: true
published: false
img_path: /img/ws2022/
image:
  path: /img/preview_translate.jpg
  lqip: data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAASABIAAD/2wBDAAsICAoIBwsKCQoNDAsNERwSEQ8PESIZGhQcKSQrKigkJyctMkA3LTA9MCcnOEw5PUNFSElIKzZPVU5GVEBHSEX/2wBDAQwNDREPESESEiFFLicuRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUX/wAARCAAIABADASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAID/8QAHxAAAAUFAQEAAAAAAAAAAAAAAQIDBSEABAYREzFh/8QAFQEBAQAAAAAAAAAAAAAAAAAAAQP/xAAYEQACAwAAAAAAAAAAAAAAAAAAIQECEf/aAAwDAQACEQMRAD8AxanTGW5tTJcWKih9yfmBjD8gd1GROOMLWyJEkeR5g6Jw1ET4FKUxVl8Z/9k=
---

Установка Windows Server 2022 на компьютер с архитектурой arm – Macbook M2 для учебных целей
Описание эксперимента:
Данные заметки будут применимы, ко всем компьютерам линейки macbook air/pro на базе процессоров M1 M2 M3 архитектуры arm.

Мой Macbook Air M2 8/256 2022

![iStat Menus](2024-04-06_11-16-32.png){: .shadow : .left }

ДИСКЛЕЙМЕР!!! Я всего лишь любитель и экспериментатор, который любит сложные задачи и простые решения, но во время выполнения данного эксперимента мой макбук находился в сверх перегреве (отсутствие активной системы охлаждения оказывает свое влияние)
Рекомендую установить датчики iStat Menus

## Рассмотрим установку через UTM - (требует минимальных усилий, бесплатно)

Необходимые приложения\библиотеки\связи: 

1. Установить brew
Необходимо в терминале выполнить команду:



Детальная инструкция по установке есть на официальном сайте.

2. Установить инструменты разработчика xcode
Необходимо в терминале выполнить команду:

```bash
xcode-select --install
```

3. Установить UTM
Необходимо в терминале выполнить команду:

```bash
brew install utm
```

4. Установить qemu
Необходимо в терминале выполнить команду:

```bash
brew install qemu
```

5. Скачиваем дамп Windows Server 2022

## Установка Windows Server 
![Меню установки UTM](2024-04-06_11-32-38.png){: .shadow }

Выбираем процесс эмуляции, а не виртуализации, т.к. мы планируем использовать образ системы созданный для другой архитектуры

![Меню установки UTM](2024-04-07_16-43-40.png){: .shadow }

Далее не нужно выбирать "другую систему" - мы будем устанавливать с преднастройками для Windows 10/11 
Несколько раз пробовал устанавливать через "Autre" но встроенный биос даже не хотел запускаться или видеть образ системы. Поэтому прислушайтесь к моему опыту и выбирайте Windows 10/11

![Меню установки UTM](2024-04-07_16-44-45.png){: .shadow }

Выбираем образ нашей системы - у меня была испошльзован оффициальный образ системы с мартовским обновлениями 2024 года Windows Server 2022 (на дату написания статьи апрель 2024)
Остальные галочки оставляем без изменений - делаем как на скриншоте.

![Меню установки UTM](2024-04-07_16-46-03.png){: .shadow }

ОЧЕНЬ внимательно! В интеренете много читал про эмуляцию Windows Server и что она очень медленная и много негативных отзывов такого подхода. Но в моем случае (повторю Macbook air M2 8/256 ) все работает на приемлимом уровне, хотя температура во время установки пугает. Мне ведь нужна система для обучения, а не реального развертывания ДАТАЦЕНТРА. 

Первый раз когда я устанавливал WS мне тоже показалось все очень медленным и слишком глючным, но каково было мое удивление, что при установке со стандартными параметрами UTM пытается устанавливать виндовс эмулируя только одно ядро. 1! Странно, что про это не говорят люди учитывая - лаги и тормоза эмулируемой системы. 

![Диспетчер задач с установленной системы со стандартнымии настройками эмулируемого процессора](2024-04-06_01-21-55.png){: .shadow }
Действительно работать в такой системе даже в учебных целях было невозможно. 

РЕШЕНИЕ: Указываем ядра вручную. Для тестовых целей указал 4 ядра и установка и запуск новой системы прошли намного быстрее. Думаю на вашем Macbook Pro можно указать больше выделенных ядер. 

Оперативную память выбираем чем больше - тем лучше. Я выбирал 4гб, но если бы был макбук с 16гб выбирал бы 8гб. Тут логика простая.

Далее...
![Меню установки UTM](2024-04-07_16-48-52.png){: width="700" height="400" : .shadow }

Размер постоянной памяти, учитывая ваши нужны (и возможности)

После установщик предложил мне выбрать общую папку для файлов (это можно выбрать позднее, но в своем случае создал отдельный каталог для пользования WS)

![Меню установки UTM](2024-04-07_16-51-09.png){: .shadow }

Установщик резюмирет все введенные нами настройки для конечного подтверждения
![Меню установки UTM](2024-04-07_16-52-09.png){: .shadow }


Теперь у нас появилась система в окне выбора в UTM 
![Меню установки UTM](2024-04-07_16-52-49.png){: .shadow }

Запускаем 
При первом запуске меня забросило на такое окно, решается вводом комманды 
![Меню установки UTM](2024-04-07_16-53-53.png){: .shadow }

```bash
exit
```

И без изменения настроек биоса - делаем сброс - reset
![Меню установки UTM](2024-04-07_16-54-46.png){: .shadow }

## Press any key to load ...

Нажимаем любую клавишу

И через какое-то время видим привычное окно установки Windows

![Меню установки UTM](2024-04-07_16-57-23.png){: .shadow }

Советы по установке: 

Во время установки windows Server не забываем указать нужную систему: 

небольшие пояснения: 
- Desktop Experience позволяет иметь графический интерфейс, привычный из настольных версий виндовс
- Datacenter version позволит создать виртуальные учетные записи (пользователи системы)

Т.е. для моих учебных целей я буду устанавливать Windows Server 2022 (desktop Experience) Datacenter license

А теперь внимание на температуры во время установки: 
![Меню установки UTM](2024-04-06_00-53-47.png){: .shadow }

После установки у нас будет стандартное окно разблокировани виндовс в котором нас попросят ввести Ctrl + Alt + Detele для разблокировки, но так как таких клавиш нет вставлю здесь один ответ с GitHub UTM  ссылка на пост https://github.com/utmapp/UTM/issues/3413#issuecomment-1001997191 (GoXLd: так же вы всегда можете установить стандартную клавиатуру)
![Меню установки UTM](2024-04-07_17-53-27.png){: .shadow }

Так же не забываем, что при первом запуске система должна установить UTM Guest Tool 

![Меню установки UTM](2024-04-07_17-53-27.png){: .shadow }

В остальном как мне показалось запускать Windows Server таким способом на m2 8/256 полнейших мазохизм. Система с более точесно настроенной эмуляцией работает намного лучше (меньше вылетом и зависаний) но совершенно далеко от плавности виртуализации. Встати при работе Windows server 2022 нет перегрева системы и средняя температура macbook сохраняется в пределах 60-65 градусов.

_Merci de votre attention !_




  



  

